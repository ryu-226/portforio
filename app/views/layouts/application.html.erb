<!DOCTYPE html>
<html>
  <head>
    <title>
      <%= (content_for?(:title) ? "#{yield(:title)} | " : "") + "めしガチャ" %>
    </title>

    <%= favicon_link_tag 'favicon-16x16.png', rel: 'icon', type: 'image/png', sizes: '16x16' %>
    <%= favicon_link_tag 'favicon-32x32.png', rel: 'icon', type: 'image/png', sizes: '32x32' %>
    <link rel="apple-touch-icon" sizes="180x180" href="<%= asset_path 'apple-touch-icon.png' %>">

    <%= yield :meta %>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload" %>
  </head>

  <body class="font-sans">
    <%# --- ヘッダー ---%>
    <% if user_signed_in? %>
      <%= render "layouts/header_logged_in" %>
    <% else %>
      <%= render "layouts/header" %>
    <% end %>

    <%# --- フラッシュメッセージ --- %>
    <div id="toasts" class="fixed z-50 top-20 inset-x-4 sm:inset-x-auto sm:left-1/2 sm:-translate-x-1/2 space-y-2">
      <% flash.each do |type, message| %>
        <% next if type.to_s == "draw_amount" %>
        <% color =
          case type.to_s
          when "notice" then "bg-green-600"
          when "alert", "error" then "bg-red-600"
          else "bg-gray-700"
          end %>
        <div class="toast pointer-events-auto rounded-lg px-4 py-3 text-white shadow-lg ring-1 ring-black/5 text-sm sm:text-base break-words max-w-full sm:max-w-md transition-all duration-300 opacity-100"
            role="<%= %w[alert error].include?(type.to_s) ? 'alert' : 'status' %>"
            aria-live="polite" data-timeout="3000">
          <div class="<%= color %> rounded-lg px-3 py-2">
            <div class="flex items-start gap-3">
              <span class="flex-1"><%= message %></span>
              <button type="button" class="toast-close shrink-0 opacity-80 hover:opacity-100" aria-label="閉じる">×</button>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <%# --- メインコンテンツ --- %>
    <main class="<%= (controller_name.in?(%w[main home]) && action_name == 'index') ? '' : 'animate-fadein' %>">
      <%= yield %>
    </main>

    <%# --- フッター --- %>
    <% if user_signed_in? %>
      <%= render "layouts/footer_logged_in" %>
    <% else %>
      <%= render "layouts/footer" %>
    <% end %>
  </body>
</html>
